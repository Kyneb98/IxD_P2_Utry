<div class="page-container">
  <app-zalando-top-bar></app-zalando-top-bar>

<mat-grid-list cols="2" rowHeight="1:1">
  <!-- Left column -->
  <mat-grid-tile>
    <img src="/utryDamer.png" style="width: 100%; height: 100%;" />
  </mat-grid-tile>

  <!-- Right column -->
  <mat-grid-tile>
    <div style="height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;">
      <mat-card appearance="outlined" style="width: 600px; height: 700px; position: relative;">

      <form [formGroup]="measurementForm" (ngSubmit)="onSubmit()" novalidate class="measurement-input-area" >
        <div [ngSwitch]="currentStep" style="height: 100%; display: flex; flex-direction: column;">
          <!-- Step 1 -->
          <div *ngSwitchCase="1" class="switch-container">
            <h3>Step 1: Measure Your Waist</h3>
            <div class="black-box">Video</div>
            <mat-form-field appearance="outline" class="centered-input">
              <mat-label>Enter your measurement</mat-label>
              <input matInput type="number"
               formControlName="value"
                placeholder="e.g., 80 cm"
                required />
              <span matTextSuffix>cm</span>
              <mat-error *ngIf="valueControl?.hasError('required') && valueControl?.touched">Value is required</mat-error>
              <mat-error *ngIf="valueControl?.hasError('pattern') && valueControl?.touched">Must be a valid number</mat-error>
            </mat-form-field>
          </div>

          <!-- Step 2 -->
          <div *ngSwitchCase="2" class="switch-container">
            <h3>Step 2: Measure Your Chest</h3>
            <div class="black-box">Video</div>
            <mat-form-field appearance="outline" class="centered-input">
              <mat-label>Enter your measurement</mat-label>
              <input matInput
               formControlName="value"
                placeholder="e.g., 90 cm"
                required />
              <span matTextSuffix>cm</span>
              <mat-error *ngIf="valueControl?.hasError('required') && valueControl?.touched">Value is required</mat-error>
              <mat-error *ngIf="valueControl?.hasError('pattern') && valueControl?.touched">Must be a valid number</mat-error>
            </mat-form-field>
          </div>

          <!-- Step 3 -->
          <div *ngSwitchCase="3" class="switch-container">
            <h3>Step 3: Measure Your Arms</h3>
            <div class="black-box">Video</div>
            <mat-form-field appearance="outline" class="centered-input">
              <mat-label>Enter your measurement</mat-label>
              <input matInput
               formControlName="value"
                placeholder="e.g., 50 cm"
                required />
              <span matTextSuffix>cm</span>
              <mat-error *ngIf="valueControl?.hasError('required') && valueControl?.touched">Value is required</mat-error>
              <mat-error *ngIf="valueControl?.hasError('pattern') && valueControl?.touched">Must be a valid number</mat-error>
            </mat-form-field>
          </div>

          <!-- Step 4 -->
          <div *ngSwitchCase="4" class="switch-container">
            <h3>Step 4: Measure Your Shoulders</h3>
            <div class="black-box">Video</div>
            <mat-form-field appearance="outline" class="centered-input">
              <mat-label>Enter your measurement</mat-label>
              <input matInput
               formControlName="value"
                placeholder="e.g., 40 cm"
                required />
              <span matTextSuffix>cm</span>
              <mat-error *ngIf="valueControl?.hasError('required') && valueControl?.touched">Value is required</mat-error>
              <mat-error *ngIf="valueControl?.hasError('pattern') && valueControl?.touched">Must be a valid number</mat-error>
            </mat-form-field>
          </div>

          <!-- Step 5 -->
          <div *ngSwitchCase="5" class="switch-container">
            <h3>Step 5: Measure Your Front Bodice</h3>
            <div class="black-box">Video</div>
            <mat-form-field appearance="outline" class="centered-input">
              <mat-label>Enter your measurement</mat-label>
              <input matInput
               formControlName="value"
                placeholder="e.g., 60 cm"
                required />
              <span matTextSuffix>cm</span>
              <mat-error *ngIf="valueControl?.hasError('required') && valueControl?.touched">Value is required</mat-error>
              <mat-error *ngIf="valueControl?.hasError('pattern') && valueControl?.touched">Must be a valid number</mat-error>
            </mat-form-field>
          </div>
        </div>
      </form>

        <!-- Button container -->
        <div style="position: absolute; bottom: 16px; left: 16px; right: 16px; display: flex; align-items: center;">
          <button mat-raised-button color="warn" *ngIf="currentStep > 1" (click)="prevStep()" style="margin-right: auto;">Back</button>
          <!-- ONLY call onSubmit on click -->
          <button mat-raised-button color="primary" *ngIf="currentStep < totalSteps" (click)="onSubmit()" style="margin-left: auto;" [disabled]="isLoading || measurementForm.invalid || !currentUserId">
               <span *ngIf="!isLoading">Save & Next</span>
               <span *ngIf="isLoading">Saving...</span>
          </button>
          <!-- Finish button still only calls onSubmit -->
          <button mat-raised-button
           color="primary"
            *ngIf="currentStep === totalSteps"
             (click)="onSubmit()"
              style="margin-left: auto;"
              [disabled]="isLoading || measurementForm.invalid || !currentUserId"
               routerLink="/onboarding"
               queryParams="{ step: '2' }">
              <span *ngIf="!isLoading">Finish</span>
              <span *ngIf="isLoading">Saving...</span>
          </button>
        </div>
      </mat-card>
    </div>
  </mat-grid-tile>
</mat-grid-list>
</div>
